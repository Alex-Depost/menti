# Тесты API с использованием Tavern

## Установка зависимостей

Для запуска тестов необходимо установить следующие зависимости:

```bash
pip install pytest tavern pyyaml pytest-sugar
```

## Структура тестов

- `test_api.tavern.yaml` - Основные тесты API (аутентификация, API ленты)
- `test_metrics_requests.tavern.yaml` - Тесты для эндпоинтов метрик и запросов
- `utils.py` - Вспомогательные функции для проверки структуры ответов
- `config.yaml` - Конфигурационный файл с переменными окружения

## Запуск тестов

Перед запуском тестов необходимо запустить API:

```bash
cd back
uvicorn src.main:app --reload
```

В отдельном терминале запустите тесты:

```bash
cd back
python -m pytest tests/ -v
```

Для запуска конкретного файла тестов:

```bash
cd back
python -m pytest tests/test_api.tavern.yaml -v
```

## Переменные окружения

Перед запуском тестов убедитесь, что в файле `config.yaml` указан правильный URL API.
По умолчанию используется `http://localhost:8000`.

## Примечания

1. Тесты предполагают, что база данных пуста или содержит данные, не конфликтующие с тестовыми пользователями.
2. Для очистки базы данных между запусками тестов можно использовать фикстуры pytest (не реализовано).
3. Некоторые тесты могут быть нестабильными при параллельном запуске, поэтому рекомендуется запускать их последовательно. 